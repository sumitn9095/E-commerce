<app-header></app-header>

<div class="">
  <div class="m-3 sm:w-9/12 mx-auto">
    <!-- <app-shopping-list-db></app-shopping-list-db> -->
    <div class="card flex justify-content-center">
      <app-shopping-filters [categoryListDefined]="categoryListDefined" [maxProductPrice]="maxProductPrice"
        (payloadShoppingFilterValue)="filterProducts($event)"></app-shopping-filters>
    </div>

    <p-panel header="Header">
      @defer (on viewport; prefetch on timer(0)) {
      <div class="form-group">
        <!-- <form [formGroup]="buyProductsForm"> -->
        <!-- <input type="checkbox" class="" placeholder="selectedAny" name="selectedAny" formControlName="selectedAny"  /> -->
        <div class="flex items-start justify-center">
          <div class="w-full mx-auto">
            <div class="card">
              <button type="button" (click)="singleReq_addProducts()">Buy</button>
              <p-table [value]="products().products" [(selection)]="selectedProducts" dataKey="id">
                <ng-template pTemplate="header">
                  <tr>
                    <th style="width: 4rem">
                      <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                    </th>
                    <th>Id</th>
                    <th>Name</th>
                    <th>Category</th>
                    <th>InStock</th>
                    <th>Price</th>
                    <th>Manufacturing Date</th>
                    <th>Expiry Date</th>
                    <th>Action</th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-product>
                  <tr>
                    <td>
                      <p-tableCheckbox [value]="product"></p-tableCheckbox>
                    </td>
                    <td>{{product.id}}</td>
                    <td>{{product.name}}</td>
                    <td>{{product.category}}</td>
                    <td>{{product.instock}}</td>
                    <td>{{product.price}}</td>
                    <td>{{product.md}}</td>
                    <td>{{product.ed}}</td>
                    <td>
                      <p-button severity="success" (click)="addProduct(product)"> + </p-button>
                    </td>
                  </tr>
                </ng-template>
              </p-table>
            </div>
          </div>
        </div>
        <!-- </form> -->
      </div>
      } @placeholder {
      <div></div>
      } @loading {
      <p-progressSpinner></p-progressSpinner>
      <div>
        <p-skeleton styleClass="mb-2"></p-skeleton>
        <p-skeleton styleClass="mb-2"></p-skeleton>
        <p-skeleton styleClass="mb-2"></p-skeleton>
      </div>
      } @error {
      <i class="pi pi-search"></i>
      }
    </p-panel>

    <app-sidecart [detectChange]="_cart.onDetectChangeSideCart()" [cart]="_cart.cart()" [cartSpecs]="cartSpecs()"
      [orderId]="orderId" [categoryListDefined]="categoryListDefined" [maxProductPrice]="maxProductPrice"
      (filterQuery)="filter_cart($event)" (fetchCartOutput)="fetch_cart()">
    </app-sidecart>

    <!-- Product Add Toast Notification -->
    <!-- <p-toast position="bottom-right" key="addProduct" [baseZIndex]="5000">
      <ng-template let-message pTemplate="message">
        <div class="flex flex-col align-items-start" style="flex: 1">
          <div>
            <img title="{{ latestProductAdded.product.name }}" class="shadow-2 block xl:block mx-auto border-round"
              [src]="'https://placehold.co/362x180?text='+ (latestProductAdded.type === 'single' ?
              latestProductAdded.product.name : selectedProductsDetails.productNames.toString()) "
              [alt]="'{{ latestProductAdded.product.name}}'" />
          </div>
          <div>
            <div class="flex flex-row">
              @if(latestProductAdded.type == 'single'){
              <div class="w-60">
                {{latestProductAdded.product.id}}
              </div>
              }
              <div class="flex flex-row justify-between w-full font-bold text-900 ">
                <div class="w-3/4">
                  {{ latestProductAdded.type == 'single' ? latestProductAdded.product.name : '' }}
                  @for(e of selectedProducts; track e.id){
                  <div>{{e.name}} ({{e.category}}) - {{e.price}}</div>
                  }
                </div>
                <div>
                  {{ latestProductAdded.type == 'single' ?latestProductAdded.product.price : selectedProductsDetails.totalPrice }}
                </div>
              </div>
            </div>
          </div>

        </div>
      </ng-template>
    </p-toast> -->


    <p-toast position="bottom-left" key="addProduct" [baseZIndex]="5000">
      <ng-template let-message pTemplate="headless" let-closeFn="closeFn">
        <div class="flex flex-col align-items-start" style="flex: 1">
          <div>
            <img title="{{ latestProductAdded.product.name }}" class="shadow-2 block xl:block mx-auto border-round"
              [src]="'https://placehold.co/362x180?text='+ (message.data.type === 'single' ?
              message.data.product.name : message.data.productNames.toString()) "
              [alt]="'{{ message.data.product.name}}'" />
          </div>
          <div>
            <div class="flex flex-row">
              @if(message.data.type === 'single'){
              <div class="w-60">
                {{message.data.product.id}}
              </div>
              }
              <div class="flex flex-row justify-between w-full font-bold text-900 ">
                <div class="w-3/4">
                  {{ message.data.type === 'single' ? message.data.product.name : '' }}
                  @if(message.data.type !== 'single'){
                  @for(e of selectedMultipleProducts; track e.id) {
                  <div>{{e.name}} ({{e.category}}) - {{e.price}}</div>
                  }
                  }
                </div>
                <div>
                  {{ message.data.type == 'single' ? message.data.product.price : message.data.totalPrice }}
                </div>
              </div>
            </div>
          </div>

        </div>
      </ng-template>
    </p-toast>
  </div>
</div>
